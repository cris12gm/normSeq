{% extends "base.html" %}
{% load static %}

{% block css %}
<link href="{% static 'css/customStyles/stylesQuery.css'%}" rel="stylesheet">
{% endblock %}

{% block modals %}
    {% include "modals/query/chooseInput.html" %}
    {% include "modals/query/chooseMethod.html" %}
    {% include "modals/query/uploadAnnotation.html" %}
    {% include "modals/query/chooseAnnotation.html" %}
    {% include "modals/query/chooseParameters.html" %}
{% endblock %}

{% load crispy_forms_tags %}    

{% block content %}

<div class="menu-hide" id="menu-hide">
    <div class="d-flex justify-content-center mt-3">
        <img id="titleIndex" width="40%" src="{% static 'images/titleBig.png'%}">
    </div>
    
    <hr>
    <div class="row">
        <div class="col-md-11"style="float:none;margin:auto;">
            <div class="card">
                <div class="card-body">
                    <div class="text-center">
                        <div class="btn-group btn-group-lg mr-3" role="group" id="aBtnGroup" aria-label="Basic example">
                            <button type="button" value="miRNA" name="miRNA" class="btn btn-info">miRNA</button>
                            <button type="button" value="mRNA" name="mRNA" class="btn btn-info">mRNA</button>
                            <button type="button" value="tRNA" name="tRNA" class="btn btn-info">tRNA</button>
                            <button type="button" value="feature" name="Other" class="btn btn-info">Other</button>
                        </div>
                        <div class="btn-group btn-group-lg">
                            <button type="button" id="loadEx" name="Example Data" class="btn btn-warning ml-3">Load Example Data</button>
                            <button type="button" class="btn btn-light" data-toggle="modal" data-target="#modalTestData"><i class="fas fa-solid fa-question" style="color:#f0ad4e;"></i></button>
                            <div class="modal fade" id="modalTestData" tabindex="-1" role="dialog" aria-labelledby="modalTestData" aria-hidden="true">
                                <div class="modal-dialog modal-lg" role="document">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                        <h5 class="modal-title">Example Data</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                        </div>
                                        <div class="modal-body">
                                            <p>The test dataset for NormSeq corresponds to the mouse tissue samples from the GEO dataset <a href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE141436">GSE141436</a>.</p>                                            
                                            <p>It consists of the tRNA-sequencing raw counts matrix, at tRNA isodecoder level, of 21 different samples from seven mouse tissues, derived from the central nervous system (CNS), liver, tibialis and heart mouse tissues.</p>
                                            <p>Please, if you use the test dataset, cite the following publication:</p>
                                            <p>Pinkard O, McFarland S, Sweet T, Coller J. Quantitative tRNA-sequencing uncovers metazoan tissue-specific tRNA regulation. Nat Commun. 2020 Aug 14;11(1):4104. doi: <a href="https://doi.org/10.1038/s41467-020-17879-x">10.1038/s41467-020-17879-x</a>. PMID: 32796835; PMCID: PMC7428014.</p>
                                            
                                        </div>
                                        <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="btn-group btn-group-lg">
                            <a class="btn btn-secondary ml-3" href="https://arn.ugr.es/normSeq/results/?jobID=QQ8PYQ7TE1ZPWJ6" role="button">See Example Query</a>
                        </div>
                        <h5 id="ExampleLoaded" class="mt-2" style="color:#041C34;"></h5>
                    </div>
                    <h3 id="selectedRNA">
                    </h3>
                    <br>
                    <div id="formMirna" style="display:block;">
                        {% crispy form %}
                    </div>
                </div>
            </div>
            <div class='form-group'>
            </div>  
        </div>
    </div>
</div>
{% endblock %}

{% block js %}

<script>
    $(document).ready(
        function() {
              // Get click event, assign button to var, and get values from that var
                $('#aBtnGroup button').on('click', function() {
                    var thisBtn = $(this);
                    
                    thisBtn.addClass('active').siblings().removeClass('active');
                    var btnValue = thisBtn.val();
                    
                    if (btnValue=="feature") {
                        var name = "Other"
                    }
                    else{
                        var name = btnValue;
                    }
                    // document.getElementById("RNAselected").innerHTML = "<b>RNA class: </b>"+name;
                    document.getElementById("selectedRNA").innerHTML = name;
                    document.getElementById("id_typeJob").value = btnValue;

                }); 
                $('#aBtnGroup button[value="miRNA"]').click();
    });
    
</script>


<script>
    $(document).ready(
        function() {
            var jobIDValue = document.getElementById("id_jobID");
            jobIDValue.value = "{{ jobID }}";
            document.getElementById("divFileBatch").style.display="none";
        });

</script>

<!-- Load example data -->
<script type="text/javascript">
     $('#loadEx').on('click', function(){
        $('#aBtnGroup button[value="miRNA"]').click();
        $('#id_url').val("https://arn.ugr.es/normSeq/static/testFiles/exampleMatrix.txt");
        $('[href="#url"]').tab('show');
        $('#id_annotationURL').val("http://arn.ugr.es/normSeq/static/testFiles/templateExample.txt");
        $('[href="#annotation_url"]').tab('show');
        var ele=document.getElementsByName('methods');  
                for(var i=0; i<ele.length; i++){  
                    if(ele[i].type=='checkbox' && ele[i].value=='NN' | ele[i].value=='CPM' | ele[i].value=='QN'){
                        ele[i].checked=true;
                    }
                    
                }     
        document.getElementById("ExampleLoaded").innerHTML = "Example data was loaded";

   });
</script>

<script>
    $('#id_batchEffect').change(function(){ 
            valor = this.value;
            if (valor == 'True'){
                document.getElementById("divFileBatch").style.display="block";
            }
            if (valor == 'False' ){
                document.getElementById("divFileBatch").style.display="none";
            }
            
        });
</script>

<script>
    $('.select-all').click(function(){
        var ele=document.getElementsByName('methods');  
                for(var i=0; i<ele.length; i++){  
                    if(ele[i].type=='checkbox')  
                        ele[i].checked=true;  
                }  
    });
    $('.deselect-all').click(function(){
        var ele=document.getElementsByName('methods');  
        for(var i=0; i<ele.length; i++){  
                    if(ele[i].type=='checkbox')  
                        ele[i].checked=false;  
                }
            });
    $('.resetbtn').click(function(){
        document.getElementById("ExampleLoaded").innerHTML = "";
            });
</script>

{% endblock %}